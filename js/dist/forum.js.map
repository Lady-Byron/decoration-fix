{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,GCLRF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3ER,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,mBCAlF,MAAM,EAA+BI,OAAOC,KAAKC,OAAO,aCKxD,SAASC,IACP,IAAI,IAAAC,EACIF,EACHG,OAAOL,UAA6B,OAAlBI,EAAAC,OAAOL,OAAOC,WAAI,EAAlBG,EAAoBF,SAAUG,OAAOL,OAAOE,SAAY,CAAC,EACxEI,EAAUJ,EAAO,gBAAkBA,EAAO,sBAC1CK,EAAOD,IAAYA,EAAO,SAAYA,GAE5C,IAAKC,EAGH,YADAC,WAAWL,EAAgB,KAI7B,GAAII,EAAKV,UAAUY,gBAAiB,OAEpC,IAAMC,EAAOH,EAAKV,UAAUc,YAE5BJ,EAAKV,UAAUc,YAAc,WAE3B,IAAIC,EACJ,IAAI,IAAAC,EAAAC,EAAAC,EACFH,EAAIF,EAAOA,EAAKX,KAAKiB,MAA0B,OAArBH,EAAiB,OAAjBC,EAAIE,KAAKC,eAAQ,EAAbH,EAAAf,KAAAiB,OAAiBH,EAAkB,OAAlBE,EAAIC,KAAKE,gBAAS,EAAdH,EAAAhB,KAAAiB,KAAiB,WACtE,CAAE,MAAOG,GAAI,CAGb,GAAiB,iBAANP,EAAgB,OAAOA,EAGlC,GAAIA,GAAkB,iBAANA,EAAgB,KAAAQ,EAAAC,EAAAC,EAExBC,GACU,OAAdH,EAAAJ,KAAKE,gBAAS,EAAdE,EAAArB,KAAAiB,KAAiB,kBACJ,OADkBK,EAC/BL,KAAKC,eAAQ,EAAbI,EAAAtB,KAAAiB,SACc,OADGM,EACjBN,KAAKE,gBAAS,EAAdI,EAAAvB,KAAAiB,KAAiB,cACjB,GAGF,IACEzB,OAAOC,eAAeoB,EAAG,SAAU,CAAEY,MAAO,WAAF,OAAQD,CAAI,EAAEE,cAAc,GACxE,CAAE,MAAON,GACPP,EAAEc,OAAS,kBAAMH,CAAI,CACvB,CAEA,IAAKX,EAAEe,UAAYf,EAAEe,WAAapC,OAAOM,UAAU8B,SACjD,IACEpC,OAAOC,eAAeoB,EAAG,WAAY,CAAEY,MAAO,WAAF,OAAQD,CAAI,EAAEE,cAAc,GAC1E,CAAE,MAAON,GACPP,EAAEe,SAAW,kBAAMJ,CAAI,CACzB,CAEJ,CAEA,OAAOX,CACT,EAEAL,EAAKV,UAAUY,iBAAkB,CAGnC,CAAE,MAAOU,GAEPX,WAAWL,EAAgB,IAC7B,CACF,C,MAEAyB,GAAAA,aAAiBC,IAAI,4BAA6B,WAEhD1B,GACF,E","sources":["webpack://@lady-byron/decoration-fix/webpack/bootstrap","webpack://@lady-byron/decoration-fix/webpack/runtime/compat get default export","webpack://@lady-byron/decoration-fix/webpack/runtime/define property getters","webpack://@lady-byron/decoration-fix/webpack/runtime/hasOwnProperty shorthand","webpack://@lady-byron/decoration-fix/external root \"flarum.core.compat['forum/app']\"","webpack://@lady-byron/decoration-fix/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","// lady-byron/decoration-fix — forum entry\n// 逻辑等同于你提供的 <script>：保持装饰返回对象，给其补 toJSON/toString 便于序列化\n\nimport app from 'flarum/forum/app';\n\nfunction installAdapter() {\n  try {\n    const compat =\n      (window.flarum && (window.flarum.core?.compat || window.flarum.compat)) || {};\n    const UserMod = compat['models/User'] || compat['common/models/User'];\n    const User = UserMod && (UserMod.default || UserMod);\n\n    if (!User) {\n      // 初始化时序未就绪，稍后重试\n      setTimeout(installAdapter, 120);\n      return;\n    }\n\n    if (User.prototype.__lb_dn_patched) return;\n\n    const orig = User.prototype.displayName;\n\n    User.prototype.displayName = function () {\n      // 先拿到（可能被 user-decoration 改造过的）“富对象”\n      let v;\n      try {\n        v = orig ? orig.call(this) : (this.username?.() ?? this.attribute?.('username'));\n      } catch (e) {}\n\n      // 已经是字符串则原样返回\n      if (typeof v === 'string') return v;\n\n      // 如果是对象（常见：被 user-decoration 包装）\n      if (v && typeof v === 'object') {\n        // 取纯文本名用于序列化兜底（避免再次递归 displayName）\n        const text =\n          this.attribute?.('displayName') ||\n          this.username?.() ||\n          this.attribute?.('username') ||\n          '';\n\n        // 给对象打上 toJSON / toString，JSON.stringify 或 ''+obj 时会用\n        try {\n          Object.defineProperty(v, 'toJSON', { value: () => text, configurable: true });\n        } catch (e) {\n          v.toJSON = () => text;\n        }\n\n        if (!v.toString || v.toString === Object.prototype.toString) {\n          try {\n            Object.defineProperty(v, 'toString', { value: () => text, configurable: true });\n          } catch (e) {\n            v.toString = () => text;\n          }\n        }\n      }\n\n      return v;\n    };\n\n    User.prototype.__lb_dn_patched = true;\n    // 可选：调试日志\n    // console.log('[decoration-fix] displayName adapter installed');\n  } catch (e) {\n    // 兜底重试（初始化顺序不确定）\n    setTimeout(installAdapter, 120);\n  }\n}\n\napp.initializers.add('lady-byron-decoration-fix', () => {\n  // 与页眉脚本一致：只打适配器，不改变其它逻辑\n  installAdapter();\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","installAdapter","_window$flarum$core","window","UserMod","User","setTimeout","__lb_dn_patched","orig","displayName","v","_this$username","_this$username2","_this$attribute","this","username","attribute","e","_this$attribute2","_this$username3","_this$attribute3","text","value","configurable","toJSON","toString","app","add"],"sourceRoot":""}